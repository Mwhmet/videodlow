<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VideoFlow ‚Äî Video ƒ∞ndirici</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --blue-deep: #0a0f2e;
    --blue-mid: #0d1b4b;
    --blue-glow: #1a3a8f;
    --blue-bright: #2563eb;
    --blue-electric: #3b82f6;
    --blue-light: #60a5fa;
    --blue-pale: #93c5fd;
    --cyan: #06b6d4;
    --cyan-glow: #22d3ee;
    --white: #f0f6ff;
    --text-dim: #8ba4cc;
    --card-bg: rgba(13, 27, 75, 0.7);
    --border: rgba(59, 130, 246, 0.2);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--blue-deep);
    color: var(--white);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 20% 20%, rgba(37,99,235,0.25) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgba(6,182,212,0.15) 0%, transparent 60%),
      radial-gradient(ellipse 40% 60% at 60% 10%, rgba(26,58,143,0.3) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(59,130,246,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(59,130,246,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }
  .container { position: relative; z-index: 1; max-width: 860px; margin: 0 auto; padding: 40px 20px 80px; }
  header { text-align: center; margin-bottom: 48px; animation: fadeDown 0.8s ease both; }
  .logo { display: inline-flex; align-items: center; gap: 12px; margin-bottom: 16px; }
  .logo-icon { width: 48px; height: 48px; background: linear-gradient(135deg, var(--blue-bright), var(--cyan)); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; box-shadow: 0 0 30px rgba(37,99,235,0.5); }
  .logo-text { font-family: 'Syne', sans-serif; font-size: 28px; font-weight: 800; background: linear-gradient(135deg, var(--white), var(--cyan-glow)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .tagline { color: var(--text-dim); font-size: 15px; font-weight: 300; }
  .platforms { display: flex; justify-content: center; gap: 10px; margin-top: 18px; flex-wrap: wrap; }
  .platform-badge { background: rgba(37,99,235,0.15); border: 1px solid rgba(59,130,246,0.25); border-radius: 20px; padding: 5px 14px; font-size: 12px; color: var(--blue-pale); font-weight: 500; }
  .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; padding: 32px; backdrop-filter: blur(20px); box-shadow: 0 25px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05); animation: fadeUp 0.8s ease 0.2s both; }
  .section-label { font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--blue-light); margin-bottom: 10px; }
  .url-wrapper { position: relative; margin-bottom: 24px; }
  .url-input { width: 100%; background: rgba(10,15,46,0.8); border: 1.5px solid var(--border); border-radius: 14px; padding: 16px 140px 16px 20px; font-size: 15px; color: var(--white); font-family: 'DM Sans', sans-serif; outline: none; transition: all 0.3s; }
  .url-input::placeholder { color: var(--text-dim); }
  .url-input:focus { border-color: var(--blue-electric); box-shadow: 0 0 0 3px rgba(59,130,246,0.15); }
  .fetch-btn { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, var(--blue-bright), var(--cyan)); border: none; border-radius: 10px; padding: 9px 18px; color: white; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 13px; cursor: pointer; transition: all 0.2s; }
  .fetch-btn:hover { transform: translateY(-50%) scale(1.03); box-shadow: 0 4px 20px rgba(37,99,235,0.5); }
  .preview-section { display: none; margin-bottom: 24px; animation: fadeUp 0.5s ease both; }
  .preview-section.visible { display: block; }
  .preview-box { background: rgba(10,15,46,0.6); border: 1px solid var(--border); border-radius: 16px; padding: 20px; display: flex; gap: 20px; align-items: flex-start; }
  .preview-thumb { width: 160px; height: 90px; border-radius: 10px; flex-shrink: 0; background: linear-gradient(135deg, var(--blue-glow), var(--blue-mid)); display: flex; align-items: center; justify-content: center; font-size: 32px; overflow: hidden; position: relative; }
  .preview-thumb img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
  .preview-info { flex: 1; min-width: 0; }
  .preview-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 15px; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .preview-meta { font-size: 13px; color: var(--text-dim); display: flex; gap: 16px; flex-wrap: wrap; }
  .platform-tag { display: inline-flex; align-items: center; gap: 5px; background: rgba(6,182,212,0.15); border: 1px solid rgba(6,182,212,0.3); border-radius: 6px; padding: 2px 8px; font-size: 11px; color: var(--cyan-glow); font-weight: 600; margin-top: 8px; }
  .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
  .option-group label { display: block; font-size: 12px; color: var(--text-dim); margin-bottom: 8px; font-weight: 500; }
  .format-tabs { display: flex; gap: 8px; }
  .format-tab { flex: 1; padding: 12px; background: rgba(10,15,46,0.8); border: 1.5px solid var(--border); border-radius: 12px; color: var(--text-dim); font-family: 'Syne', sans-serif; font-weight: 700; font-size: 14px; cursor: pointer; transition: all 0.2s; text-align: center; }
  .format-tab.active { background: linear-gradient(135deg, rgba(37,99,235,0.3), rgba(6,182,212,0.2)); border-color: var(--blue-electric); color: var(--white); box-shadow: 0 0 15px rgba(37,99,235,0.2); }
  .format-tab .tab-icon { font-size: 18px; display: block; margin-bottom: 3px; }
  .format-tab .tab-ext { font-size: 11px; opacity: 0.7; }
  .quality-pills { display: flex; gap: 8px; flex-wrap: wrap; }
  .quality-pill { padding: 8px 16px; background: rgba(10,15,46,0.8); border: 1.5px solid var(--border); border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: var(--text-dim); }
  .quality-pill:hover { border-color: var(--blue-electric); color: var(--white); }
  .quality-pill.active { background: rgba(37,99,235,0.25); border-color: var(--blue-electric); color: var(--white); }
  .download-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--blue-bright) 0%, var(--cyan) 100%); border: none; border-radius: 14px; color: white; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 16px; cursor: pointer; transition: all 0.3s; box-shadow: 0 8px 30px rgba(37,99,235,0.4); }
  .download-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(37,99,235,0.6); }
  .download-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
  .btn-content { display: flex; align-items: center; justify-content: center; gap: 10px; }
  .progress-section { display: none; margin-top: 20px; }
  .progress-section.visible { display: block; }
  .progress-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; }
  .progress-status { color: var(--blue-pale); font-weight: 500; }
  .progress-pct { color: var(--cyan-glow); font-family: 'Syne', sans-serif; font-weight: 700; }
  .progress-bar { height: 6px; background: rgba(59,130,246,0.15); border-radius: 10px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--blue-bright), var(--cyan-glow)); border-radius: 10px; width: 0%; transition: width 0.3s ease; box-shadow: 0 0 10px rgba(6,182,212,0.5); }
  .toast { position: fixed; bottom: 30px; right: 30px; background: rgba(13,27,75,0.97); border: 1px solid rgba(6,182,212,0.4); border-radius: 16px; padding: 16px 24px; display: flex; align-items: center; gap: 14px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); backdrop-filter: blur(20px); z-index: 1000; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); max-width: 340px; }
  .toast.show { transform: translateX(0); }
  .toast-icon { width: 40px; height: 40px; background: rgba(6,182,212,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
  .toast-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 14px; margin-bottom: 2px; }
  .toast-sub { font-size: 12px; color: var(--text-dim); }
  .download-link { display: inline-block; margin-top: 12px; padding: 10px 20px; background: linear-gradient(135deg, var(--blue-bright), var(--cyan)); border-radius: 10px; color: white; text-decoration: none; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 14px; }
  .divider { height: 1px; background: var(--border); margin: 24px 0; }
  .orb { position: fixed; border-radius: 50%; filter: blur(80px); pointer-events: none; z-index: 0; }
  .orb-1 { width: 300px; height: 300px; background: rgba(37,99,235,0.12); top: -100px; right: -100px; }
  .orb-2 { width: 200px; height: 200px; background: rgba(6,182,212,0.1); bottom: 100px; left: -50px; }
  @keyframes fadeDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.7s linear infinite; }
  @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } .preview-box { flex-direction: column; } .preview-thumb { width: 100%; height: 180px; } .toast { right: 16px; left: 16px; max-width: none; } }
</style>
</head>
<body>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="container">
  <header>
    <div class="logo">
      <div class="logo-icon">‚ö°</div>
      <span class="logo-text">VideoFlow</span>
    </div>
    <p class="tagline">T√ºm sosyal medyadan video & fotoƒüraf indir</p>
    <div class="platforms">
      <span class="platform-badge">‚ñ∂ YouTube</span>
      <span class="platform-badge">üì∏ Instagram</span>
      <span class="platform-badge">üéµ TikTok</span>
      <span class="platform-badge">üê¶ Twitter/X</span>
      <span class="platform-badge">üìò Facebook</span>
      <span class="platform-badge">üëæ Reddit</span>
      <span class="platform-badge">üé¨ Vimeo</span>
      <span class="platform-badge">+ Daha fazlasƒ±</span>
    </div>
  </header>

  <div class="card">
    <div class="section-label">Video / Fotoƒüraf Linki</div>
    <div class="url-wrapper">
      <input class="url-input" id="urlInput" type="text" placeholder="https://youtube.com/watch?v=... veya ba≈üka bir link">
      <button class="fetch-btn" onclick="fetchPreview()">üîç √ñnizle</button>
    </div>

    <div class="preview-section" id="previewSection">
      <div class="section-label">√ñn ƒ∞zleme</div>
      <div class="preview-box">
        <div class="preview-thumb" id="previewThumb">
          <img id="previewImg" src="" alt="" style="display:none">
          <span id="previewEmoji">üé¨</span>
        </div>
        <div class="preview-info">
          <div class="preview-title" id="previewTitle">‚Äî</div>
          <div class="preview-meta">
            <span id="previewDuration">‚è± ‚Äî</span>
            <span id="previewViews">üëÅ ‚Äî</span>
          </div>
          <div class="platform-tag" id="previewPlatform">üåê Platform</div>
        </div>
      </div>
      <div class="divider"></div>
    </div>

    <div class="options-grid">
      <div class="option-group">
        <label>Format Se√ß</label>
        <div class="format-tabs">
          <div class="format-tab active" onclick="selectFormat('mp4', this)">
            <span class="tab-icon">üé¨</span>MP4<div class="tab-ext">Video</div>
          </div>
          <div class="format-tab" onclick="selectFormat('mp3', this)">
            <span class="tab-icon">üéµ</span>MP3<div class="tab-ext">Ses</div>
          </div>
          <div class="format-tab" onclick="selectFormat('jpg', this)">
            <span class="tab-icon">üñº</span>Foto<div class="tab-ext">JPG</div>
          </div>
        </div>
      </div>
      <div class="option-group" id="qualityGroup">
        <label>Video Kalitesi</label>
        <div class="quality-pills">
          <div class="quality-pill active" onclick="selectQuality('1080p', this)">1080p</div>
          <div class="quality-pill" onclick="selectQuality('720p', this)">720p</div>
          <div class="quality-pill" onclick="selectQuality('480p', this)">480p</div>
          <div class="quality-pill" onclick="selectQuality('360p', this)">360p</div>
        </div>
      </div>
    </div>

    <button class="download-btn" id="downloadBtn" onclick="startDownload()">
      <div class="btn-content" id="btnContent">
        <span>‚¨á</span><span>ƒ∞NDƒ∞R</span>
      </div>
    </button>

    <div class="progress-section" id="progressSection">
      <div class="progress-header">
        <span class="progress-status" id="progressStatus">Hazƒ±rlanƒ±yor...</span>
        <span class="progress-pct" id="progressPct">0%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast">
  <div class="toast-icon" id="toastIcon">‚úÖ</div>
  <div>
    <div class="toast-title" id="toastTitle">Tamamlandƒ±!</div>
    <div class="toast-sub" id="toastSub">ƒ∞ndirme ba≈üarƒ±lƒ±.</div>
  </div>
</div>

<script>
  let selectedFormat = 'mp4';
  let selectedQuality = '1080p';
  let currentTaskId = null;
  let pollInterval = null;

  async function fetchPreview() {
    const url = document.getElementById('urlInput').value.trim();
    if (!url) { showToast('‚ö†Ô∏è', 'Link Gerekli', 'L√ºtfen bir link girin.', true); return; }

    try {
      const res = await fetch('/preview', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({url})
      });
      const data = await res.json();
      if (data.error) { showToast('‚ùå', 'Hata', data.error, true); return; }

      document.getElementById('previewTitle').textContent = data.title || 'Ba≈ülƒ±ksƒ±z';
      document.getElementById('previewDuration').textContent = '‚è± ' + (data.duration || '‚Äî');
      document.getElementById('previewViews').textContent = 'üëÅ ' + (data.views ? data.views.toLocaleString() : '‚Äî');
      document.getElementById('previewPlatform').textContent = 'üåê ' + (data.platform || 'Web');

      const img = document.getElementById('previewImg');
      if (data.thumbnail) {
        img.src = data.thumbnail;
        img.style.display = 'block';
        document.getElementById('previewEmoji').style.display = 'none';
      }
      document.getElementById('previewSection').classList.add('visible');
    } catch(e) {
      showToast('‚ùå', 'Baƒülantƒ± Hatasƒ±', 'Sunucuya ula≈üƒ±lamadƒ±.', true);
    }
  }

  function selectFormat(format, el) {
    selectedFormat = format;
    document.querySelectorAll('.format-tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    const qg = document.getElementById('qualityGroup');
    if (format === 'mp3') {
      qg.innerHTML = `<label>Ses Kalitesi</label><div class="quality-pills"><div class="quality-pill active" onclick="selectQuality('320kbps',this)">320 kbps</div><div class="quality-pill" onclick="selectQuality('192kbps',this)">192 kbps</div><div class="quality-pill" onclick="selectQuality('128kbps',this)">128 kbps</div></div>`;
      selectedQuality = '320kbps';
    } else if (format === 'jpg') {
      qg.innerHTML = `<label>Fotoƒüraf Kalitesi</label><div class="quality-pills"><div class="quality-pill active" onclick="selectQuality('original',this)">Orijinal</div><div class="quality-pill" onclick="selectQuality('high',this)">Y√ºksek</div></div>`;
      selectedQuality = 'original';
    } else {
      qg.innerHTML = `<label>Video Kalitesi</label><div class="quality-pills"><div class="quality-pill active" onclick="selectQuality('1080p',this)">1080p</div><div class="quality-pill" onclick="selectQuality('720p',this)">720p</div><div class="quality-pill" onclick="selectQuality('480p',this)">480p</div><div class="quality-pill" onclick="selectQuality('360p',this)">360p</div></div>`;
      selectedQuality = '1080p';
    }
  }

  function selectQuality(q, el) {
    selectedQuality = q;
    el.closest('.quality-pills').querySelectorAll('.quality-pill').forEach(p => p.classList.remove('active'));
    el.classList.add('active');
  }

  async function startDownload() {
    const url = document.getElementById('urlInput').value.trim();
    if (!url) { showToast('‚ö†Ô∏è', 'Link Gerekli', 'L√ºtfen bir link girin.', true); return; }

    const btn = document.getElementById('downloadBtn');
    btn.disabled = true;
    document.getElementById('btnContent').innerHTML = `<div class="spinner"></div><span>Ba≈ülatƒ±lƒ±yor...</span>`;
    document.getElementById('progressSection').classList.add('visible');

    try {
      const res = await fetch('/download', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({url, format: selectedFormat, quality: selectedQuality})
      });
      const data = await res.json();
      currentTaskId = data.task_id;
      pollProgress();
    } catch(e) {
      resetBtn();
      showToast('‚ùå', 'Hata', 'Sunucuya baƒülanƒ±lamadƒ±.', true);
    }
  }

  function pollProgress() {
    pollInterval = setInterval(async () => {
      if (!currentTaskId) return;
      const res = await fetch(`/status/${currentTaskId}`);
      const data = await res.json();

      const pct = data.progress || 0;
      document.getElementById('progressFill').style.width = pct + '%';
      document.getElementById('progressPct').textContent = pct + '%';

      if (pct < 30) document.getElementById('progressStatus').textContent = 'Baƒülanƒ±yor...';
      else if (pct < 60) document.getElementById('progressStatus').textContent = 'ƒ∞ndiriliyor...';
      else if (pct < 95) document.getElementById('progressStatus').textContent = 'D√∂n√º≈üt√ºr√ºl√ºyor...';
      else document.getElementById('progressStatus').textContent = 'Tamamlanƒ±yor...';

      if (data.status === 'done') {
        clearInterval(pollInterval);
        document.getElementById('progressFill').style.width = '100%';
        document.getElementById('progressPct').textContent = '100%';
        document.getElementById('progressStatus').textContent = 'Tamamlandƒ±! ‚úÖ';

        setTimeout(() => {
          window.location.href = `/file/${currentTaskId}`;
          resetBtn();
          showToast('‚úÖ', 'ƒ∞ndirme Tamamlandƒ±!', `${selectedFormat.toUpperCase()} ‚Äî ${selectedQuality} kalitesinde indirildi.`, false);
        }, 500);

      } else if (data.status === 'error') {
        clearInterval(pollInterval);
        resetBtn();
        showToast('‚ùå', 'Hata Olu≈ütu', data.error || 'Bilinmeyen hata.', true);
      }
    }, 800);
  }

  function resetBtn() {
    const btn = document.getElementById('downloadBtn');
    btn.disabled = false;
    document.getElementById('btnContent').innerHTML = `<span>‚¨á</span><span>ƒ∞NDƒ∞R</span>`;
    setTimeout(() => {
      document.getElementById('progressSection').classList.remove('visible');
      document.getElementById('progressFill').style.width = '0%';
      document.getElementById('progressPct').textContent = '0%';
    }, 2000);
  }

  function showToast(icon, title, sub, isWarning) {
    const toast = document.getElementById('toast');
    document.getElementById('toastIcon').textContent = icon;
    document.getElementById('toastTitle').textContent = title;
    document.getElementById('toastSub').textContent = sub;
    toast.style.borderColor = isWarning ? 'rgba(251,191,36,0.4)' : 'rgba(6,182,212,0.4)';
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 5000);
  }

  document.getElementById('urlInput').addEventListener('keydown', e => { if (e.key === 'Enter') fetchPreview(); });
</script>
</body>
</html>
